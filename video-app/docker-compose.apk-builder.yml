# =============================================================================
# 视频应用 - APK 构建 Docker Compose 配置
# APK Builder Docker Compose Configuration
# =============================================================================
# 使用方法:
#   构建 Debug APK:
#     docker-compose -f docker-compose.apk-builder.yml up --build
#   
#   构建 Release APK:
#     docker-compose -f docker-compose.apk-builder.yml run --rm apk-builder release
# =============================================================================

version: '3.8'

services:
  apk-builder:
    build:
      context: .
      dockerfile: Dockerfile.apk-builder
    container_name: video-app-apk-builder
    # 默认构建 debug 版本
    command: ["debug"]
    volumes:
      # 将 APK 输出到本地 output 目录
      - ./output:/app/output
      # 可选: 挂载 Gradle 缓存以加速后续构建
      - gradle-cache:/root/.gradle
    environment:
      - TZ=Asia/Shanghai
      - GRADLE_USER_HOME=/root/.gradle
    # 构建需要较多内存
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
    labels:
      - "app.name=video-app-apk-builder"
      - "app.description=视频应用 APK 构建环境"

volumes:
  gradle-cache:
    name: video-app-gradle-cache
